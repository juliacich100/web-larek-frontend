# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:
- слой данных (отвечает за хранение и изменение данных),
- слой представления (отвечает за отображение данных на странице),
- презентер (отвечает за связь представления и данных).

### Данные и типы данных, используемые в приложении

Данные товара
```
interface IProduct {
    id: string;
    category: string;
    title: string;
    image: string;
    description: string;
    price: number;
}
```
Данные товара в корзине
```
type TBasketItem = Pick<IProduct, 'id' | 'title' | 'price'> & {index: number;}
```
Данные заказа
```
interface IServerOrder {
    payment: "card" | "cash";
    email: string;
    phone: string;
    address: string;
    total: number;
    items: string[]

    addItem(id: string): void;
    getItem(id: string): string | null;
    deleteItem(id: string): void;
    setTotal(total: number): void;
    setPayment(value: string): void;
    setAddress(value: string): void;
    setEmail(value: string): void;
    setPhone(value: string): void;
    getAddress(): string | null;
    getEmail(): string | null;
    getPhone(): string | null;
    clearContacts(): void;
}
```
Модель данных приложения
```
interface IModel {
    _items: IProduct[];
    order: IServerOrder;

    getItem(id:string): IProduct | null;
    getOrder(): IServerOrder;
    getOrderItems(): IProduct[];
    findPricelessItem(): boolean;
    setPayment(value: string): void;
    setAddress(value: string): void;
    setEmail(email: string): void;
    setPhone(phone: string): void;
    validateAddress(): string | null;
    validateContacts(): string | null;
    deletePricelessFromOrder(): void;
    countTotal(): number;
    saveTotal(): void;
    clearOrderContacts(): void;
}
```

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер;
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

### Слой данных

#### Класс Model
отвечает за хранение и логику работы с данными приложения.

В полях класса хранятся следующие данные:
- _items: IProduct[] - массив объектов карточек товаров;
- order: IServerOrder - текущий заказ клиента (объект, реализующий интерфейс IServerOrder);

Класс предоставляет набор методов для работы с данными:
- getItem(id:string): IProduct | null - возвращает товар по его id;
- getOrder(): IOrder - возвращает заказ;
- getOrderItems(): IProduct[] - собирает и возвращает все товары из заказа по их id из списка доступных товаров;
- findPricelessItem(): boolean - ищет товар без цены (где price === null) в списке товаров текущего заказа;
- setPayment(value: string): void - устанавливает способ оплаты заказа, используя метод setPayment объекта order;
- setAddress(value: string): void - устанавливает адрес доставки для текущего заказа, используя метод setAddress объекта order;
- setEmail(email: string): void - устанавливает email клиента для текущего заказа, используя метод setEmail объекта order;
- setPhone(phone: string): void - устанавливает номер телефона клиента для текущего заказа, используя метод setPhone объекта order;
- validateAddress(): string | null - проверяет, указан ли адрес доставки для текущего заказа: возвращает текст ошибки, если поле не заполнено;
- validateContacts(): string | null - проверяет, указаны ли все контактные данные (email и телефон) для текущего заказа; при отсутствии какого-то из данных возвращает сообщение об ошибке, иначе — null;
- deletePricelessFromOrder(): void - удаляет товар без цены из текущего заказа;
- countTotal(): number - вычисляет и возвращает общую стоимость заказа, суммируя цены всех товаров в заказе;
- saveTotal(): void - сохраняет итоговую сумму заказа в объекте order, используя метод setTotal;
- clearOrderContacts(): void -  очищает контактные данные (address, mail, phone) в заказе, вызывая метод clearContacts объекта order;
- а также сеттер items(data: IProduct[]) устанавливает значение для поля _items.


#### Класс IServerOrder
отвечает за хранение и работу с данными заказа

Поля класса хранят:
- payment: "card" | "cash" - хранит информацию о способе оплаты заказа (значение может быть либо "card", либо "cash");
- email: string - email пользователя;
- phone: string - номер телефона пользователя;
- address: string - адрес доставки;
- total: number - хранит общую сумму товаров заказа;
- items: string[] | null - массив id товаров, добавленных в заказ;

Класс предоставляет следующий набор методов:
- addItem(id: string): void - добавляет товар в список товаров заказа, добавляя его идентификатор в массив items;
- getItem(id: string): string | null - ищет товар по его id в массиве items;
- deleteItem(id: string): void - удаляет товар из списка items по его id;
- setPayment(value: string): void - устанавливает способ оплаты заказа (принимает строку value, которая может быть либо "Онлайн", либо "При получении", и на основе этого присваивает значение полю payment);
- setAddress(value: string): void - устанавливает адрес доставки для заказа;
- setEmail(value: string): void - устанавливает email пользователя;
- setPhone(value: string): void - устанавливает номер телефона пользователя;
- getAddress(): string | null - возвращает адрес доставки;
- getEmail(): string | null - возвращает почту пользователя;
- getPhone(): string | null - возвращает телефон пользователя;
- clearContacts(): void - очищает контактные данные (address, email, phone);
- setTotal(total: number): void - станавливает общую сумму заказа в поле total;


### Классы представления

#### Класс Card
отвечает за отображение карточек карточек на странице сайта. Поля класса содержат ссылки на элементы разметки карточки.
В конструктор класса передается шаблон карточки товара, объект презентера и объект товара. В классе устанавливается слушатель на клик по элементу карточки.

Поля класса:
- item: IProduct - хранит объект карточки товара;
- itemElement: HTMLButtonElement - хранит ссылку на элемент карточки товара;
- goodsType: HTMLElement - элемент, в котором отображается информация о категории товара;
- goodsName: HTMLElement - элемент, в котором отображается название товара;
- goodsImg: HTMLElement - элемент, в котором отображается изображение товара;
- goodsPrice: HTMLElement - элемент, в котором отображается цена товара;

Методы класса позволяют взаимодействовать с данными товара (устанавливать и получать категорию, название, изображение и цену), а также обрабатывать клик по карточке товара для отображения подробной информации через презентер.

Методы:
- handleClick(presenter: IPresenter): void - обрабатывает клик по карточке товара;
- render(): HTMLElement - возвращает клонированный элемент карточки товара;
- а так-же сеттеры и геттеры для сохранения и получения данных из полей класса.


#### Класс Popup
реализует модальное окно. Это объект, предоставляющий функциональность для открытия / закрытия модального окна, изменения содержимого окна через свойство content. Конструктор класса принимает элемент, который представляет собой сам контейнер модального окна. Класс устанавливает слушатели на клик в оверлей и кнопку-крестик для закрытия попапа.

Поля класса:
- container: HTMLElement - хранит ссылку на контейнер модального окна;
- closeButton: HTMLButtonElement - хранит ссылку на кнопку закрытия модального окна;
- _content: HTMLElement - хранит ссылку на элемент содержимого модального окна;

Методы:
- open(): void - метод открывает модальное окно;
- close(): void - закрытие модального окна;
- closeByOverlayClick(evt: MouseEvent): void - закрытие модального окна по клику на оверлей.


#### Класс Preview
отвечает за отображение выбранной карточки в модальном окне.
Поля класса содержат ссылки на элементы разметки карточки и объект презентера. В конструктор класса передается DOM элемент темплейта. В классе устанавливается слушатель на кнопке добавления товара в корзину.

Поля класса:
- id: string - хранит ID карточки;
- cardPreview: HTMLDivElement;
- image: HTMLImageElement;
- category: HTMLSpanElement
- title: HTMLElement;
- text: HTMLParagraphElement;
- basketButton: HTMLButtonElement;
- price: HTMLSpanElement;
- presenter: IPresenter;

Методы:
- render(): HTMLElement -  возвращает клонированный элемент карточки товара;
- setData(item: IProduct): void - задает данные для элементов карточки товара;
- disableBasketbutton(): void - отключает кнопку добавления товара в корзину и изменяет текст на кнопке, показывая, что товар уже добавлен в корзину ("Товар в корзине");
- enableBasketButton(): void - восстанавливает активность кнопки добавления в корзину и изменяет текст кнопки обратно на "В корзину";
- handleBasketButtonClick(): void - метод обрабатывает клик по кнопке добавления товара в корзину. Он проверяет, находится ли товар уже в корзине, и в зависимости от этого либо добавляет товар в корзину, либо блокирует кнопку;
- setPresenter(presenter: IPresenter): void - метод устанавливает презентер;


#### Класс Basket
отвечает за рендеринг и управление состоянием корзины, а также для отображения и взаимодействия с товарами в корзине (например, удаление товара или обновление цены). Поля класса содержат ссылки на элементы разметки корзины и объект презентера. В конструктор класса передается шаблон корзины, который будет использован для клонирования основного элемента корзины, шаблон для элементов корзины, которые будут представлять отдельные товары, конструктор для создания элементов корзины для каждого товара. В классе устанавливается слушатель на кнопке корзины "Оформить".

Поля класса:
- presenter: IPresenter - хранит объект Презентера, который взаимодействует с данными корзины и выполняет бизнес-логику;
- basketElement: HTMLDivElement - хранит элемент, который представляет собой сам контейнер для корзины;
- basketButton: HTMLButtonElement - элемент кнопки корзины;
- price: HTMLSpanElement - элемент, который отображает общую цену всех товаров в корзине;
- basketList: HTMLElement - контейнер, в который будут добавляться элементы для каждого товара;
- orderTemplate: HTMLTemplateElement - шаблон, который используется для отображения каждого товара в корзине;
- itemConstructor: IBasketItemConstructor - хранит конструктор для создания элементов корзины;

Методы:
- setPresenter(presenter: IPresenter): void - метод устанавливает презентер для корзины;
- render(): HTMLElement - отвечает за отображение товаров в корзине и их общей стоимости;
- handleDeleteItem(id: string): void - удаляет товар из корзины по его id;
- setPrice(value: number): void - отвечает за отображение цены в корзине;
- disableBasketButton(): void - отключает кнопку оформления заказа (например, если корзина пуста или содержит только товары без цены);
- enableBasketButton(): void - включает кнопку оформления заказа, если корзина содержит товары, которые можно оплатить;
- setBasketButtonState(): void - метод проверяет состояние корзины и обновляет кнопку оформления заказа;
- clearBasket(): void - очищает корзину, удаляя все товары.


#### Класс BasketItem
отвечает за представление одного товара в корзине, его рендеринг и взаимодействие с пользователем (например, удаление товара). В конструктор
класса передается шаблон для элементов корзины, объект данных, который представляет информацию о товаре в корзине, функция, которая будет вызываться, когда пользователь нажимает на иконку удаления товара из корзины

Поля класса:
- itemData: TBasketItem - объект, который хранит данные о товаре в корзине;
- index: HTMLSpanElement - элемент, который отображает индекс товара в корзине;
- title: HTMLSpanElement - элемент, который отображает название товара;
- itemPrice: HTMLSpanElement - элемент, который отображает цену товара;
- orderElement: HTMLDivElement - контейнер для элемента товара в корзине;
- deleteIcon: HTMLElement - иконка удаления товара из корзины.

Методы:
- render(): HTMLDivElement - возвращает элемент товара в корзине;
- setText(): void - устанавливает значения для индекса, названия и цены товара.



#### Класс PaymentForm
отвечает за логику работы с формой оплаты, включая отображение, взаимодействие с пользователем и передачу данных для дальнейшей обработки.
В конструктор класса передается шаблон формы оплаты. Устанавливаются слушатели на элементе самой формы, на поле ввода и на кнопке отправки
формы. Поля класса содержат ссылки на элементы разметки формы и объект презентера.

Поля класса:
- formElement: HTMLFormElement - элемент формы для оплаты;
- cardButton: HTMLButtonElement - кнопка для выбора оплаты картой;
- cashButton: HTMLButtonElement - кнопка для выбора оплаты наличными;
- inputField: HTMLInputElement - поле ввода для адреса;
- formErrors: HTMLSpanElement - элемент для отображения ошибок формы;
- submitButton: HTMLButtonElement - кнопка отправки формы;
- presenter: IPresenter - презентер.

Методы:
- setPresenter(presenter: IPresenter): void - передает презентер в форму;
- render(): HTMLElement - возвращает элемент формы;
- clearForm(): void - очищает форму, деактивирует кнопку отправки;
- handlePayment(evt: MouseEvent): void - обработчик клика по кнопкам для выбора способа оплаты;
- togglePaymentMethod(targetButton: HTMLButtonElement, - otherButton: HTMLButtonElement): void - переключает активное состояние между двумя кнопками;
- getPaymentMethod(): void - возвращает текущий выбранный метод оплаты, если он выбран;
- isInputFilled(): boolean - проверяет, заполнено ли поле ввода;
- savePaymentAndAdress(): void - cохраняет выбранный метод оплаты и введённый адрес с помощью презентера;
- isFormValid(): boolean - проверяет, валидна ли форма;
- handleInput(): void - обрабатывает ввод данных в форму: если форма валидна, убирает ошибки и активирует кнопку отправки, иначе отображает ошибку и деактивирует кнопку;
- showInputError(): void - устанавливает текст ошибки;
- hideInputError(): void - скрывает текст ошибки;
- setSubmitState(isValid: boolean): void - активирует или деактивирует кнопку отправки в зависимости от валидности формы;
- handleNextButton(event: MouseEvent): void - обрабатывает клик по кнопке "Далее": вызывает метод презентера для открытия формы с контактами.


#### Класс ContacsForm
отвечает за логику работы с формой контактов. Он следит за вводом данных, управляет состоянием кнопки отправки и передает информацию презентеру для дальнейшей обработки. В конструктор класса передается шаблон формы контактов. Устанавливаются слушатели на поля ввода и на кнопке отправки
формы. Поля класса содержат ссылки на элементы разметки формы и объект презентера.

Поля класса:
- formElement: HTMLFormElement - элемент формы контактов;
- emailInput: HTMLInputElement - поле ввода для почты;
- phoneInput: HTMLInputElement - поле ввода для телефона;
- formErrors: HTMLSpanElement - элемент для отображения ошибок формы;
- submitButton: HTMLButtonElement - кнопка отправки формы;
- presenter: IPresenter - презентер.

Методы:
- setPresenter(presenter: IPresenter): void - передает презентер в форму для управления логикой формы;
- render(): HTMLElement - возвращает элемент формы;
- clearForm(): void - очищает форму, деактивирует кнопку отправки;
- isInputFilled(input: HTMLInputElement): boolean - проверяет, заполнено ли поле ввода;
- saveContacts(): void - cохраняет введённые контактные данные (email и телефон) с помощью презентера;
- isFormValid(): boolean - проверяет, валидна ли форма;
- handleInputs(): void - обрабатывает ввод данных в форму: если форма валидна, убирает ошибки и активирует кнопку отправки, иначе отображает ошибку и деактивирует кнопку;
- showInputError(): void - устанавливает текст ошибки;
- hideInputError(): void - скрывает текст ошибки;
- setSubmitState(isValid: boolean): void - активирует или деактивирует кнопку отправки в зависимости от валидности формы;
- handleSubmitButton(event: MouseEvent) - обрабатывает клик по кнопке отправки формы: вызывает метод презентера для отправки заказа.


#### Класс SuccessForm
отвечает за отображение уведомления об успешном оформлении заказа. В конструктор класса передается шаблон уведомления об успешном оформлении 
заказа. Устанавливается слушатель на кнопке "За новыми покупками!" Поля класса содержат ссылки на элементы разметки уведомления и объект презентера.

Поля класса:
- successElement: HTMLDivElement - контейнер для содержимого уведомления;
- orderDescription: HTMLParagraphElement - элемент для отображения текста о статусе заказа;
- closeButton: HTMLButtonElement - кнопка закрытия уведомления;
- presenter: IPresenter - презентер.

Методы:
- setPresenter(presenter: IPresenter): void - передает презентер в класс для управления логикой уведомления;
- render(): HTMLDivElement - возвращает элемент уведомления;
- setTotal(total: number): void - устанавливает текст уведомления с суммой заказа;
- handleClick(): void - обрабатывает клик по кнопке "За новыми покупками!": вызывает метод презентера для перехода к каталогу с товарами.

#### Класс Page
отвечает за представление страницы, которая включает отображение товаров (в контейнере) и счетчик товаров в корзине. В конструктор класса передается элемент, который представляет контейнер страницы, на которой будет отображаться контент.
Поля класса содержат ссылки на элементы разметки и объект презентера.

Поля класса:
- _goodsContainer: HTMLElement - хранит ссылку на элемент, который представляет контейнер для товаров на странице;
- _counter: HTMLElement - хранит ссылку на элемент, который отображает количество товаров в корзине;
- basketIcon: HTMLButtonElement - хранит ссылку на кнопку (иконку корзины);
- presenter: IPresenter - хранит ссылку на объект презентера;

Методы:
- сеттер goodsContainer устанавливвает переданный массив в поле _goodsContainer;
- сеттер counter обновляет текстовое содержание элемента, хранящегося в поле _counter;
- setPresenter(presenter: IPresenter): void - устанавливает презентер;
- handleClick(): void - обрабатывает клик на basketIcon.

### Слой коммуникации

#### Класс ServerApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

#### Класс Presenter
За обработку взаимодействий между Моделью и Представлением в приложении отвечает Презентер. Это взаимодействие осуществляется через методы класса, которые обновляют состояние модели и соответствующие элементы интерфейса. В конструктор Презентера передается объект типа TPresenterParams, который содержит следующие свойства:

- server - объект, который взаимодействует с сервером через API,
- model - объект модели приложения,
- viewItemConstructor - конструктор для создания карточек товаров,
- preview — объект компонента превью товара,
- popup - объект компонента для работы с попапами,
- basket — объект компонента корзины,
- paymentForm — объект формы оплаты,
- contactsForm — объект формы для ввода контактных данных,
- successPopup — объект уведомления об успешном оформлении заказа,
- viewPageContainer — объект контейнера для отображения товаров на странице
- imageUrl - строка, содержащая базовый URL для загрузки изображений товаров.

Поле класса cardTemplate хранит ссылку на элемент шаблона карточки товара.

Методы:
- renderView(): void - запрашивает список товаров с сервера. После получения списка товаров он создает карточки товаров с использованием конструктора viewItemConstructor, которые затем добавляются в контейнер товаров на странице. Также обновляется счетчик заказов.
- getCardData(id: string): IProduct | null - возвращает данные товара по id (использует метод модели, чтобы получить товар по идентификатору);
- getItemFromOrder(id: string): string | null - возвращает товар из заказа по id (использует метод модели, чтобы получить товар из заказа);
- getOrderItemsData(): IProduct[] - возвращает все товары в заказе (использует метод модели, чтобы вернуть все товары из заказа);
- setPopupContent<T>(content: T): void - устанавливает содержимое попапа;
- setOrderButtonState(item: IProduct): void - включает или отключает кнопку "В корзину" в зависимости от того, есть ли уже этот товар в заказе;
- openPreview(item: IProduct): void - открывает попап с подробной информацией о товаре;
- openBasket(): void - открывает попап корзины;
- addItemToBasket(itemId: string): void - добавляет товар в корзину;
- deleteItemFromBasket(itemId: string): void - удаляет товар из корзины;
- openPaymentForm(): void - открывает попап формы оплаты;
- getAddressError(): string | null - возвращает результат валидации адреса;
- getContactError(): string | null - возвращает результат валидации контактных данных (почта, телефон);
- setPaymentMethod(value: string): void - устанавливает метод оплаты, передавая значение в модель;
- setAddressToForm(address: string): void- устанавливает адрес доставки, передавая значение в модель;
- openContactsForm(): void - открывает попап формы для ввода контактных данных;
- setEmail(email: string): void - устанавливает email, передавая значение в модель;
- setPhone(phone: string): void - устанавливает телефон, передавая значение в модель;
- openSuccessPopup(): void - открывает попап с информацией об успешном оформлении заказа;
- closeSuccessPopup(): void - закрывает попап успеха после успешной обработки заказа;
- hasOnlyPricelessItem(): boolean - возвращает true, если в заказе есть только один товар и этот товар не имеет цены;
- pay(): void - отправляет заказ на сервер, в случае успешного ответа сервера очищает корзину и формы и отображает попап успеха.

