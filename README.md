# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:
- слой данных (отвечает за хранение и изменение данных),
- слой представления (отвечает за отображение данных на странице),
- презентер (отвечает за связь представления и данных).

### Данные и типы данных, используемые в приложении

Товар
```
interface IProduct {
    id: string;
    category: string;
    title: string;
    image: string;
    description: string;
    price: number | null;
}
```
Товар в корзине
```
type TBasketItem = Pick<IProduct, 'id' | 'title' | 'price'> & {index: number;}
```
Заказ
```
interface IServerOrder {
    payment: "online" | "offline";
    email: string;
    phone: string;
    address: string;
    total: number;
    items: string[] | null;
}
```
Модель данных коллекции товаров
```
interface IProductsModel {
    items: IProduct[];
    getProduct(id:string): IProduct | null;
    findPricelessProduct(orderItems: string[]): string | null;
    countTotal(orderItems: IProduct[]): number;
}
```
Модель данных заказа
```
interface IOrderModel {
    order: IServerOrder;
    addItem(id: string): void;
    getItem(id: string): string | null;
    deleteItem(id: string): void;
    getOrder(): IServerOrder;
    getOrderItems(): string[];
    setTotal(total: number): void;
    setPayment(value: string): void;
    setAddress(value: string): void;
    setEmail(value: string): void;
    setPhone(value: string): void;
    validateAddress(): string | null;
    validateContacts(): string | null;
    clearOrderFields(): void;
}
```

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер;
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

### Слой данных

#### Класс ProductsModel
служит для хранения и управления списком товаров.

В полях класса хранятся следующие данные:
- items: IProduct[] - массив объектов карточек товаров;

Класс предоставляет следующие методы для работы с данными:
- getProduct(id:string): IProduct | null - возвращает товар по его id;;
- findPricelessProduct(orderItems: string[]): string | null - ищет товар без цены (где price === null) в списке товаров текущего заказа;;
- countTotal(orderItems: IProduct[]): number - вычисляет и возвращает общую стоимость заказа, суммируя цены всех товаров в заказе;;


#### Класс OrderModel
отвечает за храниние заказа в виде объекта типа IServerOrder и за управление и обработку данных заказа.

В полях класса хранятся следующие данные:
- order: IServerOrder - объект заказа;

Класс предоставляет следующие методы для работы с данными:
- addItem(id: string): void - добавляет товар в список товаров заказа, добавляя его идентификатор в массив items;
- getItem(id: string): string | null - ищет товар по его id в массиве items;
- deleteItem(id: string): void - удаляет товар из списка items по его id;
- getOrder(): IServerOrder - возвращает весь объект заказа;
- getOrderItems(): string[] - возвращает список идентификаторов товаров в заказе;
- setTotal(total: number): void - устанавливает общую сумму заказа;
- setPayment(value: string): void - устанавливает способ оплаты заказа;
- setAddress(value: string): void - устанавливает адрес доставки заказа;
- setEmail(value: string): void - устанавливает email пользователя;
- setPhone(value: string): void - устанавливает номер телефона пользователя;
- validateAddress(): string | null - проверяет, заполнен ли адрес доставки. Если адрес не указан, возвращает строку с сообщением об ошибке, иначе возвращает null;
- validateContacts(): string | null - проверяет, заполнены ли обязательные контактные данные (email и телефон). Если нет, возвращает строку с сообщением об ошибке, иначе возвращает null;
- clearOrderFields(): void - очищает данные заказ.


#### Класс IServerOrder
используется для создания объекта заказа, который может быть отправлен на сервер

Поля класса хранят:
- payment: "online" | "offline" - хранит информацию о способе оплаты заказа (значение может быть либо "online", либо "offline");
- email: string - email пользователя;
- phone: string - номер телефона пользователя;
- address: string - адрес доставки;
- total: number - хранит общую сумму товаров заказа;
- items: string[] | null - массив id товаров, добавленных в заказ.


### Классы представления

#### Класс BaseItem<T>
является родительским для классов, отвечающих за работу с товаром (Card, Preview, BasketItem). Конструктор класса принимает шаблон HTMLTemplateElement.

Поля класса:
- element: HTMLElement - хранит клонированный элемент;

Методы класса:
- render(itemData: T): HTMLElement - везвращает элемент, который будет отображать переданные данные.

#### Класс Card
наследуется от класса BaseItem.
отвечает за отображение карточки товара. Поля класса содержат ссылки на элементы разметки карточки.
В конструктор класса передается шаблон карточки товара и колбэк-функция, которая будет вызываться при клике на карточку товара.

Поля класса:
- goodsType: HTMLElement - элемент, в котором отображается информация о категории товара;
- goodsName: HTMLElement - элемент, в котором отображается название товара;
- goodsImg: HTMLElement - элемент, в котором отображается изображение товара;
- goodsPrice: HTMLElement - элемент, в котором отображается цена товара;

Методы класса позволяют взаимодействовать с данными товара (устанавливать и получать категорию, название, изображение и цену), а также обрабатывать клик по карточке товара для отображения подробной информации через презентер.

Методы:
- render(item: IProduct): HTMLElement - возвращает клонированный элемент карточки товара.


#### Класс Preview
наследуется от класса BaseItem.
отвечает за отображение выбранной карточки в модальном окне.
Поля класса содержат ссылки на элементы разметки карточки. В конструктор класса передается DOM элемент темплейта и функция, которая будет вызываться при клике на кнопку "В корзину".

Поля класса:
- id: string - хранит ID карточки;
- image: HTMLImageElement;
- category: HTMLSpanElement
- title: HTMLElement;
- text: HTMLParagraphElement;
- orderButton: HTMLButtonElement;
- price: HTMLSpanElement;

Методы:
- render(item: IProduct): HTMLElement -  возвращает клонированный элемент карточки товара;
- disableBasketbutton(): void - отключает кнопку добавления товара в корзину и изменяет текст на кнопке, показывая, что товар уже добавлен в корзину ("Товар в корзине");
- enableBasketButton(): void - восстанавливает активность кнопки добавления в корзину и изменяет текст кнопки обратно на "В корзину".


#### Класс BasketItem
наследуется от класса BaseItem.
используется для отображения элемента корзины (товара) и взаимодействие с пользователем (например, удаление товара). В конструктор
класса передается шаблон для элементов корзины и колбэк-функция, которая будет вызвана при клике на иконку удаления товара из корзины.

Поля класса:
- id: string;
- index: HTMLSpanElement - элемент, который отображает индекс товара в корзине;
- title: HTMLSpanElement - элемент, который отображает название товара;
- itemPrice: HTMLSpanElement - элемент, который отображает цену товара;
- deleteIcon: HTMLElement - иконка удаления товара из корзины.

Методы:
- render(itemData: TBasketItem): HTMLElement - возвращает элемент товара в корзине.


#### Класс Popup
реализует модальное окно. Это объект, предоставляющий функциональность для открытия / закрытия модального окна, изменения содержимого окна через свойство content. Конструктор класса принимает элемент, который представляет собой сам контейнер модального окна. Класс устанавливает слушатели на клик в оверлей и кнопку-крестик для закрытия попапа.

Поля класса:
- container: HTMLElement - хранит ссылку на контейнер модального окна;
- closeButton: HTMLButtonElement - хранит ссылку на кнопку закрытия модального окна;
- _content: HTMLElement - хранит ссылку на элемент содержимого модального окна;

Методы:
- open(): void - метод открывает модальное окно;
- close(): void - закрытие модального окна;
- closeByOverlayClick(evt: MouseEvent): void - закрытие модального окна по клику на оверлей.


#### Класс Basket
отвечает за рендеринг и управление состоянием корзины. Поля класса содержат ссылки на элементы разметки корзины. В конструктор класса передается шаблон корзины,  шаблон для отображения товара в корзине, конструктор для создания элементов корзины и функция, которая будет вызвана при клике на кнопку корзины.

Поля класса:
- basketElement: HTMLDivElement - хранит элемент, который представляет собой сам контейнер для корзины;
- basketButton: HTMLButtonElement - элемент кнопки корзины;
- price: HTMLSpanElement - элемент, который отображает общую цену всех товаров в корзине;
- basketList: HTMLElement - контейнер, в который будут добавляться элементы для каждого товара;
- orderTemplate: HTMLTemplateElement - шаблон, который используется для отображения каждого товара в корзине;
- itemConstructor: IBasketItemConstructor - хранит конструктор для создания элементов корзины;

Методы:
- render(total: number): HTMLElement - отвечает за отображение товаров в корзине и их общей стоимости;
- clearBasketList(): void - очищает контейнер basketList;
- addItem(item: IProduct, index: number, onDelete: (id: string) => void): void - добавляет элемент товара в контейнер basketList;
- showEmptyBasketMessage(): void - отображает сообщение "Корзина пуста";
- disableBasketButton(): void - отключает кнопку оформления заказа (например, если корзина пуста или содержит только товары без цены);
- enableBasketButton(): void - включает кнопку оформления заказа, если корзина содержит товары, которые можно оплатить.


#### Класс PaymentForm
отвечает за логику работы с формой оплаты, включая отображение, взаимодействие с пользователем и передачу данных для дальнейшей обработки.
В конструктор класса передается шаблон формы оплаты,  функция, которая вызывается при изменении поля формы, и функция, которая вызывается при нажатии на кнопку "Далее". Поля класса содержат ссылки на элементы разметки формы.

Поля класса:
- formElement: HTMLFormElement - элемент формы для оплаты;
- cardButton: HTMLButtonElement - кнопка для выбора оплаты картой;
- cashButton: HTMLButtonElement - кнопка для выбора оплаты наличными;
- inputField: HTMLInputElement - поле ввода для адреса;
- formErrors: HTMLSpanElement - элемент для отображения ошибок формы;
- submitButton: HTMLButtonElement - кнопка отправки формы;

Методы:
- render(): HTMLElement - возвращает элемент формы;
- resetForm(): void - сброс формы в начальное состояние;
- handlePayment(evt: MouseEvent): void - обработчик клика по кнопкам для выбора способа оплаты;
- togglePaymentMethod(targetButton: HTMLButtonElement, - otherButton: HTMLButtonElement): void - переключает активное состояние между двумя кнопками;
- getPaymentMethod(): string | null - возвращает текущий выбранный метод оплаты, если он выбран;
- handleInputs(): void - обрабатывает ввод данных в форму;
- setInputError(errorText: string | null): void- отображение текста ошибки;
- setSubmitState(isValid: boolean): void - активирует или деактивирует кнопку отправки в зависимости от валидности формы;
- handleNextButton(event: MouseEvent): void - обрабатывает клик по кнопке "Далее".


#### Класс ContacsForm
отвечает за логику работы с формой контактов. Он обрабатывает события изменения полей и отправки формы. В конструктор класса передается шаблон формы контактов, функция, которая будет вызываться при изменении значения в полях формы (email и phone), и функция, которая вызывается при отправке формы. Поля класса содержат ссылки на элементы разметки формы.

Поля класса:
- formElement: HTMLFormElement - элемент формы контактов;
- emailInput: HTMLInputElement - поле ввода для почты;
- phoneInput: HTMLInputElement - поле ввода для телефона;
- formErrors: HTMLSpanElement - элемент для отображения ошибок формы;
- submitButton: HTMLButtonElement - кнопка отправки формы;

Методы:
- render(): HTMLElement - возвращает элемент формы;
- resetForm(): void - сброс формы в начальное состояние;
- handleInputs(): void - обработчик событий для полей ввода (email и phone);
- setInputError(errorText: string | null): void - устанавливает текст ошибки
- setSubmitState(isValid: boolean): void - активирует или деактивирует кнопку отправки в зависимости от валидности формы;
- handleSubmitButton(event: MouseEvent): void  - обрабатывает клик по кнопке отправки формы.


#### Класс SuccessForm
отвечает за отображение уведомления об успешном оформлении заказа. В конструктор класса передается шаблон уведомления об успешном оформлении 
заказа и функция, которая будет вызвана при клике на кнопку "За новыми покупками!". Устанавливается слушатель на кнопке "За новыми покупками!" Поля класса содержат ссылки на элементы разметки уведомления.

Поля класса:
- successElement: HTMLDivElement - контейнер для содержимого уведомления;
- orderDescription: HTMLParagraphElement - элемент для отображения текста о статусе заказа;
- closeButton: HTMLButtonElement - кнопка закрытия уведомления;

Методы:
- render(total: number): HTMLDivElement - возвращает элемент уведомления с суммой заказа.


#### Класс Page
отвечает за представление страницы, которая включает отображение товаров (в контейнере) и счетчик товаров в корзине. В конструктор класса передается элемент, который представляет контейнер страницы, на которой будет отображаться контент, и функция, которая будет вызвана при клике на иконку корзины.
Поля класса содержат ссылки на элементы разметки.

Поля класса:
- _goodsContainer: HTMLElement - хранит ссылку на элемент, который представляет контейнер для товаров на странице;
- _counter: HTMLElement - хранит ссылку на элемент, который отображает количество товаров в корзине;
- basketIcon: HTMLButtonElement - хранит ссылку на кнопку (иконку корзины);

Методы:
- сеттер goodsContainer устанавливвает переданный массив в поле _goodsContainer;
- сеттер counter обновляет текстовое содержание элемента, хранящегося в поле _counter.


### Слой коммуникации

#### Класс ServerApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

#### Класс Presenter
За обработку взаимодействий между Моделью и Представлением в приложении отвечает Презентер. Это взаимодействие осуществляется через методы класса, которые обновляют состояние модели и соответствующие элементы интерфейса. В конструктор Презентера передается объект типа TPresenterParams, который содержит следующие свойства:

- server - объект, который взаимодействует с сервером через API,
- itemModel - модель товаров,
- orderModel - модель заказа,
- viewPageContainer — объект контейнера для отображения товаров на странице,
- viewItemConstructor - конструктор для создания карточек товаров,
- preview — объект компонента превью товара,
- popup - объект компонента для работы с попапами,
- basket — объект компонента корзины,
- paymentForm — объект формы оплаты,
- contactsForm — объект формы для ввода контактных данных,
- successPopup — объект уведомления об успешном оформлении заказа,
- imageUrl - строка, содержащая базовый URL для загрузки изображений товаров.

Поле класса cardTemplate хранит ссылку на элемент шаблона карточки товара.

Методы:
- renderProductsList(): void - загружает список товаров с сервера с помощью метода getProductList() и отображает их в контейнере с помощью    конструктора карточек;
- renderBasketItems(): void - oтображает товары в корзине;
- handleDeleteItem(id: string): void - обрабатывает удаление товара из корзины по его идентификатору и обновляет состояние корзины;
- getTotalPrice(): number - возвращает общую цену товаров в корзине, вычисленную с помощью метода countTotal() из модели товаров;
- setBasketButtonState(): void - управляет состоянием кнопки корзины;
- handleOrderButtonClick(id: string): void - обрабатывает клик по кнопке "В корзину";
- getOrderIds(): string[] - получает список идентификаторов товаров в корзине с помощью метода getOrderItems() модели заказа;
- getItemFromOrder(id: string): string | null - возвращает товар из заказа по id (использует метод модели, чтобы получить товар из заказа);
- getOrderItemsData(): IProduct[] - возвращает все товары в заказе (использует метод модели, чтобы вернуть все товары из заказа);
- setPopupContent<T>(content: T): void - устанавливает содержимое попапа;
- setOrderButtonState(item: IProduct): void - включает или отключает кнопку "В корзину" в зависимости от того, есть ли уже этот товар в заказе;
- openPreview(item: IProduct): void - открывает попап с подробной информацией о товаре;
- openBasket(): void - открывает попап корзины;
- addItemToBasket(itemId: string): void - добавляет товар в корзину;
- deleteItemFromBasket(itemId: string): void - удаляет товар из корзины;
- handleAdressInputChange(payment: string, adress: string): void - обрабатывает изменение данных в форме оплаты и адреса;
- handleContactsInputChange(email: string, phone: string): void - обрабатывает изменение контактных данных (email и phone);
- openPaymentForm(): void - открывает попап формы оплаты;
- openContactsForm(): void - открывает попап формы для ввода контактных данных;
- isContactsFormValid(): boolean - проверяет, валидна ли форма с контактными данными, проверяя наличие ошибок в данных;
- isPaymentFormValid(payment: string | null): boolean - проверяет, валидна ли форма оплаты;
- openSuccessPopup(total: number): void - открывает попап с информацией об успешном оформлении заказа;
- closeSuccessPopup(): void - закрывает попап успеха после успешной обработки заказа;
- getAddressError(): string | null - возвращает результат валидации адреса;
- getContactError(): string | null - возвращает результат валидации контактных данных (почта, телефон);
- hasOnlyPricelessItem(): boolean - возвращает true, если в заказе есть только один товар и этот товар не имеет цены;
- clearBasket(): void - очищает корзину, сбрасывая все данные о заказе;
- updateBasketCounter(): void - обновляет счетчик товаров в корзине;
- pay(): void - отправляет заказ на сервер, в случае успешного ответа сервера очищает корзину и формы и отображает попап успеха.

